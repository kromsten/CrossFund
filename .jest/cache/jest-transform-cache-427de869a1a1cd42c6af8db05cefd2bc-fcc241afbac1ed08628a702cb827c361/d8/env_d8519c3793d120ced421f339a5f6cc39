753e3423673e0b60645bcc80cbf652eb
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.waitForChannel = exports.showVersions = exports.setup = exports.getContractsHashes = exports.getContractBinary = void 0;
var _axios = _interopRequireDefault(require("axios"));
var _child_process = require("child_process");
var _types = require("./types");
var _wait = require("./wait");
var _fs = require("fs");
var _path = _interopRequireDefault(require("path"));
var _crypto = _interopRequireDefault(require("crypto"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
var CONTRACTS_PATH = process.env.CONTRACTS_PATH || './contracts';
var BLOCKS_COUNT_BEFORE_START = process.env.BLOCKS_COUNT_BEFORE_START ? parseInt(process.env.BLOCKS_COUNT_BEFORE_START, 10) : 10;
var alreadySetUp = false;
var getContractBinary = /*#__PURE__*/function () {
  var _ref = _asyncToGenerator(function* (fileName) {
    return _fs.promises.readFile(_path.default.resolve(CONTRACTS_PATH, fileName));
  });
  return function getContractBinary(_x) {
    return _ref.apply(this, arguments);
  };
}();
exports.getContractBinary = getContractBinary;
var getContractsHashes = /*#__PURE__*/function () {
  var _ref2 = _asyncToGenerator(function* () {
    var hashes = {};
    for (var key of Object.keys(_types.NeutronContract)) {
      var binary = yield getContractBinary(_types.NeutronContract[key]);
      hashes[_types.NeutronContract[key]] = _crypto.default.createHash('sha256').update(binary).digest('hex');
    }
    return hashes;
  });
  return function getContractsHashes() {
    return _ref2.apply(this, arguments);
  };
}();
exports.getContractsHashes = getContractsHashes;
var setup = /*#__PURE__*/function () {
  var _ref3 = _asyncToGenerator(function* (host1, host2) {
    if (alreadySetUp) {
      console.log('already set up');
      return;
    }
    if (process.env.NO_DOCKER) {
      console.log('NO_DOCKER ENV provided');
      return;
    }
    try {
      (0, _child_process.execSync)("cd setup && make stop-cosmopark");
      // eslint-disable-next-line no-empty
    } catch (e) {}
    console.log('Starting container... it may take long');
    if (process.env.NO_REBUILD) {
      console.log('NO_REBUILD ENV provided. do not rebuild docker images');
      (0, _child_process.execSync)("cd setup && make start-cosmopark-no-rebuild");
    } else {
      (0, _child_process.execSync)("cd setup && make start-cosmopark");
    }
    showVersions();
    yield showContractsHashes();
    yield waitForHTTP(host1);
    !process.env.NO_WAIT_CHANNEL1 && (yield waitForChannel(host1));
    !process.env.NO_WAIT_HTTP2 && (yield waitForHTTP(host2));
    !process.env.NO_WAIT_CHANNEL2 && (yield waitForChannel(host2));
    !process.env.NO_WAIT_DELAY && (yield (0, _wait.wait)(20)); // FIXME: this hardcoded sleep is here to wait until hermes is fully initialized.
    //                        proper fix would be to monitor hermes status events.
    alreadySetUp = true;
  });
  return function setup(_x2, _x3) {
    return _ref3.apply(this, arguments);
  };
}();
exports.setup = setup;
var waitForHTTP = /*#__PURE__*/function () {
  var _ref4 = _asyncToGenerator(function* () {
    var host = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'http://127.0.0.1:1317';
    var path = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "blocks/".concat(BLOCKS_COUNT_BEFORE_START);
    var timeout = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 280000;
    var start = Date.now();
    while (Date.now() < start + timeout) {
      try {
        var r = yield _axios.default.get("".concat(host, "/").concat(path), {
          timeout: 1000
        });
        if (r.status === 200) {
          return;
        }
        // eslint-disable-next-line no-empty
      } catch (e) {}
      yield (0, _wait.wait)(1);
    }
    throw new Error('No port opened');
  });
  return function waitForHTTP() {
    return _ref4.apply(this, arguments);
  };
}();
var waitForChannel = /*#__PURE__*/function () {
  var _ref5 = _asyncToGenerator(function* () {
    var host = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'http://127.0.0.1:1317';
    var timeout = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 100000;
    var start = Date.now();
    while (Date.now() < start + timeout) {
      try {
        var r = yield _axios.default.get("".concat(host, "/ibc/core/channel/v1/channels"), {
          timeout: 1000
        });
        if (r.data.channels.length > 0 && r.data.channels.every(channel => channel.counterparty.channel_id !== '')) {
          yield (0, _wait.wait)(20);
          return;
        }
        // eslint-disable-next-line no-empty
      } catch (e) {}
      yield (0, _wait.wait)(1);
    }
    throw new Error('No channel opened');
  });
  return function waitForChannel() {
    return _ref5.apply(this, arguments);
  };
}();
exports.waitForChannel = waitForChannel;
var showVersions = () => {
  if (process.env.NO_DOCKER) {
    console.log('Cannot get versions since NO_DOCKER ENV provided');
    return;
  }
  var servicesAndGetVersionCommandsText = [['ICQ relayer', 'cd setup && docker compose exec relayer neutron_query_relayer version'], ['hermes', 'cd setup && docker compose exec hermes hermes version'], ['Integration tests', "git log -1 --format='%H'"]];
  for (var service of servicesAndGetVersionCommandsText) {
    try {
      var version = (0, _child_process.execSync)(service[1]).toString().trim();
      console.log("".concat(service[0], " version:\n").concat(version));
    } catch (err) {
      console.log("Cannot get ".concat(service[0], " version:\n").concat(err));
    }
  }
  var servicesAndGetVersionCommandsJson = [['neutrond', 'cd setup && docker compose exec neutron-node /go/bin/neutrond version --long -o json'], ['gaiad', 'cd setup && docker compose exec gaia-node gaiad version --long 2>&1 -o json']];
  for (var _service of servicesAndGetVersionCommandsJson) {
    try {
      var versionLong = JSON.parse((0, _child_process.execSync)(_service[1]).toString().trim());
      console.log("".concat(_service[0], " version:\nversion: ").concat(versionLong['version'], "\ncommit: ").concat(versionLong['commit']));
    } catch (err) {
      console.log("Cannot get ".concat(_service[0], " version:\n").concat(err));
    }
  }
};
exports.showVersions = showVersions;
var showContractsHashes = /*#__PURE__*/function () {
  var _ref6 = _asyncToGenerator(function* () {
    var hashes = yield getContractsHashes();
    var result = 'Contracts hashes:\n';
    for (var key of Object.keys(hashes)) {
      result = result.concat("".concat(hashes[key], " ").concat(key, "\n"));
    }
    console.log(result);
  });
  return function showContractsHashes() {
    return _ref6.apply(this, arguments);
  };
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYXhpb3MiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9jaGlsZF9wcm9jZXNzIiwiX3R5cGVzIiwiX3dhaXQiLCJfZnMiLCJfcGF0aCIsIl9jcnlwdG8iLCJvYmoiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsImFzeW5jR2VuZXJhdG9yU3RlcCIsImdlbiIsInJlc29sdmUiLCJyZWplY3QiLCJfbmV4dCIsIl90aHJvdyIsImtleSIsImFyZyIsImluZm8iLCJ2YWx1ZSIsImVycm9yIiwiZG9uZSIsIlByb21pc2UiLCJ0aGVuIiwiX2FzeW5jVG9HZW5lcmF0b3IiLCJmbiIsInNlbGYiLCJhcmdzIiwiYXJndW1lbnRzIiwiYXBwbHkiLCJlcnIiLCJ1bmRlZmluZWQiLCJDT05UUkFDVFNfUEFUSCIsInByb2Nlc3MiLCJlbnYiLCJCTE9DS1NfQ09VTlRfQkVGT1JFX1NUQVJUIiwicGFyc2VJbnQiLCJhbHJlYWR5U2V0VXAiLCJnZXRDb250cmFjdEJpbmFyeSIsIl9yZWYiLCJmaWxlTmFtZSIsImZzUHJvbWlzZSIsInJlYWRGaWxlIiwicGF0aCIsIl94IiwiZXhwb3J0cyIsImdldENvbnRyYWN0c0hhc2hlcyIsIl9yZWYyIiwiaGFzaGVzIiwiT2JqZWN0Iiwia2V5cyIsIk5ldXRyb25Db250cmFjdCIsImJpbmFyeSIsImNyeXB0byIsImNyZWF0ZUhhc2giLCJ1cGRhdGUiLCJkaWdlc3QiLCJzZXR1cCIsIl9yZWYzIiwiaG9zdDEiLCJob3N0MiIsImNvbnNvbGUiLCJsb2ciLCJOT19ET0NLRVIiLCJleGVjU3luYyIsImUiLCJOT19SRUJVSUxEIiwic2hvd1ZlcnNpb25zIiwic2hvd0NvbnRyYWN0c0hhc2hlcyIsIndhaXRGb3JIVFRQIiwiTk9fV0FJVF9DSEFOTkVMMSIsIndhaXRGb3JDaGFubmVsIiwiTk9fV0FJVF9IVFRQMiIsIk5PX1dBSVRfQ0hBTk5FTDIiLCJOT19XQUlUX0RFTEFZIiwid2FpdCIsIl94MiIsIl94MyIsIl9yZWY0IiwiaG9zdCIsImxlbmd0aCIsImNvbmNhdCIsInRpbWVvdXQiLCJzdGFydCIsIkRhdGUiLCJub3ciLCJyIiwiYXhpb3MiLCJnZXQiLCJzdGF0dXMiLCJFcnJvciIsIl9yZWY1IiwiZGF0YSIsImNoYW5uZWxzIiwiZXZlcnkiLCJjaGFubmVsIiwiY291bnRlcnBhcnR5IiwiY2hhbm5lbF9pZCIsInNlcnZpY2VzQW5kR2V0VmVyc2lvbkNvbW1hbmRzVGV4dCIsInNlcnZpY2UiLCJ2ZXJzaW9uIiwidG9TdHJpbmciLCJ0cmltIiwic2VydmljZXNBbmRHZXRWZXJzaW9uQ29tbWFuZHNKc29uIiwidmVyc2lvbkxvbmciLCJKU09OIiwicGFyc2UiLCJfcmVmNiIsInJlc3VsdCJdLCJzb3VyY2VzIjpbImVudi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuaW1wb3J0IHsgZXhlY1N5bmMgfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcbmltcG9ydCB7IENoYW5uZWxzTGlzdCwgTmV1dHJvbkNvbnRyYWN0IH0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgeyB3YWl0IH0gZnJvbSAnLi93YWl0JztcbmltcG9ydCB7IHByb21pc2VzIGFzIGZzUHJvbWlzZSB9IGZyb20gJ2ZzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IGNyeXB0byBmcm9tICdjcnlwdG8nO1xuXG5jb25zdCBDT05UUkFDVFNfUEFUSCA9IHByb2Nlc3MuZW52LkNPTlRSQUNUU19QQVRIIHx8ICcuL2NvbnRyYWN0cyc7XG5cbmNvbnN0IEJMT0NLU19DT1VOVF9CRUZPUkVfU1RBUlQgPSBwcm9jZXNzLmVudi5CTE9DS1NfQ09VTlRfQkVGT1JFX1NUQVJUXG4gID8gcGFyc2VJbnQocHJvY2Vzcy5lbnYuQkxPQ0tTX0NPVU5UX0JFRk9SRV9TVEFSVCwgMTApXG4gIDogMTA7XG5cbmxldCBhbHJlYWR5U2V0VXAgPSBmYWxzZTtcblxuZXhwb3J0IGNvbnN0IGdldENvbnRyYWN0QmluYXJ5ID0gYXN5bmMgKGZpbGVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPEJ1ZmZlcj4gPT5cbiAgZnNQcm9taXNlLnJlYWRGaWxlKHBhdGgucmVzb2x2ZShDT05UUkFDVFNfUEFUSCwgZmlsZU5hbWUpKTtcblxuZXhwb3J0IGNvbnN0IGdldENvbnRyYWN0c0hhc2hlcyA9IGFzeW5jICgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIHN0cmluZz4+ID0+IHtcbiAgY29uc3QgaGFzaGVzID0ge307XG4gIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKE5ldXRyb25Db250cmFjdCkpIHtcbiAgICBjb25zdCBiaW5hcnkgPSBhd2FpdCBnZXRDb250cmFjdEJpbmFyeShOZXV0cm9uQ29udHJhY3Rba2V5XSk7XG4gICAgaGFzaGVzW05ldXRyb25Db250cmFjdFtrZXldXSA9IGNyeXB0b1xuICAgICAgLmNyZWF0ZUhhc2goJ3NoYTI1NicpXG4gICAgICAudXBkYXRlKGJpbmFyeSlcbiAgICAgIC5kaWdlc3QoJ2hleCcpO1xuICB9XG4gIHJldHVybiBoYXNoZXM7XG59O1xuXG5leHBvcnQgY29uc3Qgc2V0dXAgPSBhc3luYyAoaG9zdDE6IHN0cmluZywgaG9zdDI6IHN0cmluZykgPT4ge1xuICBpZiAoYWxyZWFkeVNldFVwKSB7XG4gICAgY29uc29sZS5sb2coJ2FscmVhZHkgc2V0IHVwJyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmIChwcm9jZXNzLmVudi5OT19ET0NLRVIpIHtcbiAgICBjb25zb2xlLmxvZygnTk9fRE9DS0VSIEVOViBwcm92aWRlZCcpO1xuICAgIHJldHVybjtcbiAgfVxuICB0cnkge1xuICAgIGV4ZWNTeW5jKGBjZCBzZXR1cCAmJiBtYWtlIHN0b3AtY29zbW9wYXJrYCk7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWVtcHR5XG4gIH0gY2F0Y2ggKGUpIHt9XG4gIGNvbnNvbGUubG9nKCdTdGFydGluZyBjb250YWluZXIuLi4gaXQgbWF5IHRha2UgbG9uZycpO1xuICBpZiAocHJvY2Vzcy5lbnYuTk9fUkVCVUlMRCkge1xuICAgIGNvbnNvbGUubG9nKCdOT19SRUJVSUxEIEVOViBwcm92aWRlZC4gZG8gbm90IHJlYnVpbGQgZG9ja2VyIGltYWdlcycpO1xuICAgIGV4ZWNTeW5jKGBjZCBzZXR1cCAmJiBtYWtlIHN0YXJ0LWNvc21vcGFyay1uby1yZWJ1aWxkYCk7XG4gIH0gZWxzZSB7XG4gICAgZXhlY1N5bmMoYGNkIHNldHVwICYmIG1ha2Ugc3RhcnQtY29zbW9wYXJrYCk7XG4gIH1cbiAgc2hvd1ZlcnNpb25zKCk7XG4gIGF3YWl0IHNob3dDb250cmFjdHNIYXNoZXMoKTtcbiAgYXdhaXQgd2FpdEZvckhUVFAoaG9zdDEpO1xuICAhcHJvY2Vzcy5lbnYuTk9fV0FJVF9DSEFOTkVMMSAmJiAoYXdhaXQgd2FpdEZvckNoYW5uZWwoaG9zdDEpKTtcbiAgIXByb2Nlc3MuZW52Lk5PX1dBSVRfSFRUUDIgJiYgKGF3YWl0IHdhaXRGb3JIVFRQKGhvc3QyKSk7XG4gICFwcm9jZXNzLmVudi5OT19XQUlUX0NIQU5ORUwyICYmIChhd2FpdCB3YWl0Rm9yQ2hhbm5lbChob3N0MikpO1xuICAhcHJvY2Vzcy5lbnYuTk9fV0FJVF9ERUxBWSAmJiAoYXdhaXQgd2FpdCgyMCkpOyAvLyBGSVhNRTogdGhpcyBoYXJkY29kZWQgc2xlZXAgaXMgaGVyZSB0byB3YWl0IHVudGlsIGhlcm1lcyBpcyBmdWxseSBpbml0aWFsaXplZC5cbiAgLy8gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXIgZml4IHdvdWxkIGJlIHRvIG1vbml0b3IgaGVybWVzIHN0YXR1cyBldmVudHMuXG4gIGFscmVhZHlTZXRVcCA9IHRydWU7XG59O1xuXG5jb25zdCB3YWl0Rm9ySFRUUCA9IGFzeW5jIChcbiAgaG9zdCA9ICdodHRwOi8vMTI3LjAuMC4xOjEzMTcnLFxuICBwYXRoID0gYGJsb2Nrcy8ke0JMT0NLU19DT1VOVF9CRUZPUkVfU1RBUlR9YCxcbiAgdGltZW91dCA9IDI4MDAwMCxcbikgPT4ge1xuICBjb25zdCBzdGFydCA9IERhdGUubm93KCk7XG4gIHdoaWxlIChEYXRlLm5vdygpIDwgc3RhcnQgKyB0aW1lb3V0KSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHIgPSBhd2FpdCBheGlvcy5nZXQoYCR7aG9zdH0vJHtwYXRofWAsIHtcbiAgICAgICAgdGltZW91dDogMTAwMCxcbiAgICAgIH0pO1xuICAgICAgaWYgKHIuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWVtcHR5XG4gICAgfSBjYXRjaCAoZSkge31cbiAgICBhd2FpdCB3YWl0KDEpO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcignTm8gcG9ydCBvcGVuZWQnKTtcbn07XG5cbmV4cG9ydCBjb25zdCB3YWl0Rm9yQ2hhbm5lbCA9IGFzeW5jIChcbiAgaG9zdCA9ICdodHRwOi8vMTI3LjAuMC4xOjEzMTcnLFxuICB0aW1lb3V0ID0gMTAwMDAwLFxuKSA9PiB7XG4gIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcblxuICB3aGlsZSAoRGF0ZS5ub3coKSA8IHN0YXJ0ICsgdGltZW91dCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByID0gYXdhaXQgYXhpb3MuZ2V0PENoYW5uZWxzTGlzdD4oXG4gICAgICAgIGAke2hvc3R9L2liYy9jb3JlL2NoYW5uZWwvdjEvY2hhbm5lbHNgLFxuICAgICAgICB7XG4gICAgICAgICAgdGltZW91dDogMTAwMCxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgICBpZiAoXG4gICAgICAgIHIuZGF0YS5jaGFubmVscy5sZW5ndGggPiAwICYmXG4gICAgICAgIHIuZGF0YS5jaGFubmVscy5ldmVyeShcbiAgICAgICAgICAoY2hhbm5lbCkgPT4gY2hhbm5lbC5jb3VudGVycGFydHkuY2hhbm5lbF9pZCAhPT0gJycsXG4gICAgICAgIClcbiAgICAgICkge1xuICAgICAgICBhd2FpdCB3YWl0KDIwKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWVtcHR5XG4gICAgfSBjYXRjaCAoZSkge31cbiAgICBhd2FpdCB3YWl0KDEpO1xuICB9XG5cbiAgdGhyb3cgbmV3IEVycm9yKCdObyBjaGFubmVsIG9wZW5lZCcpO1xufTtcblxuZXhwb3J0IGNvbnN0IHNob3dWZXJzaW9ucyA9ICgpID0+IHtcbiAgaWYgKHByb2Nlc3MuZW52Lk5PX0RPQ0tFUikge1xuICAgIGNvbnNvbGUubG9nKCdDYW5ub3QgZ2V0IHZlcnNpb25zIHNpbmNlIE5PX0RPQ0tFUiBFTlYgcHJvdmlkZWQnKTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3Qgc2VydmljZXNBbmRHZXRWZXJzaW9uQ29tbWFuZHNUZXh0ID0gW1xuICAgIFtcbiAgICAgICdJQ1EgcmVsYXllcicsXG4gICAgICAnY2Qgc2V0dXAgJiYgZG9ja2VyIGNvbXBvc2UgZXhlYyByZWxheWVyIG5ldXRyb25fcXVlcnlfcmVsYXllciB2ZXJzaW9uJyxcbiAgICBdLFxuICAgIFsnaGVybWVzJywgJ2NkIHNldHVwICYmIGRvY2tlciBjb21wb3NlIGV4ZWMgaGVybWVzIGhlcm1lcyB2ZXJzaW9uJ10sXG4gICAgWydJbnRlZ3JhdGlvbiB0ZXN0cycsIFwiZ2l0IGxvZyAtMSAtLWZvcm1hdD0nJUgnXCJdLFxuICBdO1xuICBmb3IgKGNvbnN0IHNlcnZpY2Ugb2Ygc2VydmljZXNBbmRHZXRWZXJzaW9uQ29tbWFuZHNUZXh0KSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHZlcnNpb24gPSBleGVjU3luYyhzZXJ2aWNlWzFdKS50b1N0cmluZygpLnRyaW0oKTtcbiAgICAgIGNvbnNvbGUubG9nKGAke3NlcnZpY2VbMF19IHZlcnNpb246XFxuJHt2ZXJzaW9ufWApO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5sb2coYENhbm5vdCBnZXQgJHtzZXJ2aWNlWzBdfSB2ZXJzaW9uOlxcbiR7ZXJyfWApO1xuICAgIH1cbiAgfVxuICBjb25zdCBzZXJ2aWNlc0FuZEdldFZlcnNpb25Db21tYW5kc0pzb24gPSBbXG4gICAgW1xuICAgICAgJ25ldXRyb25kJyxcbiAgICAgICdjZCBzZXR1cCAmJiBkb2NrZXIgY29tcG9zZSBleGVjIG5ldXRyb24tbm9kZSAvZ28vYmluL25ldXRyb25kIHZlcnNpb24gLS1sb25nIC1vIGpzb24nLFxuICAgIF0sXG4gICAgW1xuICAgICAgJ2dhaWFkJyxcbiAgICAgICdjZCBzZXR1cCAmJiBkb2NrZXIgY29tcG9zZSBleGVjIGdhaWEtbm9kZSBnYWlhZCB2ZXJzaW9uIC0tbG9uZyAyPiYxIC1vIGpzb24nLFxuICAgIF0sXG4gIF07XG4gIGZvciAoY29uc3Qgc2VydmljZSBvZiBzZXJ2aWNlc0FuZEdldFZlcnNpb25Db21tYW5kc0pzb24pIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdmVyc2lvbkxvbmcgPSBKU09OLnBhcnNlKGV4ZWNTeW5jKHNlcnZpY2VbMV0pLnRvU3RyaW5nKCkudHJpbSgpKTtcbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBgJHtzZXJ2aWNlWzBdfSB2ZXJzaW9uOlxcbnZlcnNpb246ICR7dmVyc2lvbkxvbmdbJ3ZlcnNpb24nXX1cXG5jb21taXQ6ICR7dmVyc2lvbkxvbmdbJ2NvbW1pdCddfWAsXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5sb2coYENhbm5vdCBnZXQgJHtzZXJ2aWNlWzBdfSB2ZXJzaW9uOlxcbiR7ZXJyfWApO1xuICAgIH1cbiAgfVxufTtcblxuY29uc3Qgc2hvd0NvbnRyYWN0c0hhc2hlcyA9IGFzeW5jICgpID0+IHtcbiAgY29uc3QgaGFzaGVzID0gYXdhaXQgZ2V0Q29udHJhY3RzSGFzaGVzKCk7XG5cbiAgbGV0IHJlc3VsdCA9ICdDb250cmFjdHMgaGFzaGVzOlxcbic7XG4gIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKGhhc2hlcykpIHtcbiAgICByZXN1bHQgPSByZXN1bHQuY29uY2F0KGAk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